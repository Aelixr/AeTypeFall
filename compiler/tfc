!function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t.w={},t(t.s=7)}([function(e,n){e.exports=require("typescript")},function(e,n){e.exports=require("path")},function(e,n,t){"use strict";n.__esModule=!0;var r=t(0),i=function(){function e(){}return e.getChildren=function(e){var n=[];return e.forEachChild(function(e){n.push(e)}),n},e.getChildrenOfType=function(e,n){return this.getChildren(e).filter(n)},e.enumName=function(e,n){for(var t in n)if(n[t]===e)return t;return"unknown"},e.enumNames=function(e,n){var t=[];for(var r in n)0!=(e&n[r])&&e>=n[r]&&t.push(r);return t},e.containsStatement=function(e,n){return e.some(function(e){return e.kind===n})},e.isFileModule=function(e){return!!e&&e.statements.some(function(e){return 0!=(r.getCombinedModifierFlags(e)&r.ModifierFlags.Export)||e.kind===r.SyntaxKind.ExportAssignment||e.kind===r.SyntaxKind.ExportDeclaration})},e.isStringType=function(e){return 0!=(e.flags&r.TypeFlags.String)||0!=(e.flags&r.TypeFlags.StringLike)||0!=(e.flags&r.TypeFlags.StringLiteral)},e.isArrayType=function(e,n){var t=n.typeToTypeNode(e);return t&&t.kind===r.SyntaxKind.ArrayType},e.isTupleType=function(e,n){var t=n.typeToTypeNode(e);return t&&t.kind===r.SyntaxKind.TupleType},e.isCompileMembersOnlyEnum=function(e,n){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Enum)&&void 0!==e.symbol.getDocumentationComment(n)[0]&&this.hasCustomDecorator(e,n,"!CompileMembersOnly")},e.isPureAbstractClass=function(e,n){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Class)&&this.hasCustomDecorator(e,n,"!PureAbstract")},e.isExtensionClass=function(e,n){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Class)&&this.hasCustomDecorator(e,n,"!Extension")},e.isPhantom=function(e,n){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Namespace)&&this.hasCustomDecorator(e,n,"!Phantom")},e.isTupleReturnFunction=function(e,n){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Function)&&this.hasCustomDecorator(e,n,"!TupleReturn")},e.hasCustomDecorator=function(e,n,t){return!!e.symbol&&e.symbol.getDocumentationComment(n).filter(function(e){return"text"===e.kind}).map(function(e){return e.text.trim()}).filter(function(e){return"!"===e[0]}).indexOf(t)>-1},e.findFirstNodeAbove=function(e,n){for(var t=e;t.parent;){if(n(t.parent))return t.parent;t=t.parent}return null},e}();n.TSHelper=i},function(e,n,t){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])},function(e,n){function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)});n.__esModule=!0;var s,a=t(0),o=t(2),p=t(1),l=function(e){function n(n,t){var r=e.call(this,n)||this;return r.node=t,r}return i(n,e),n}(Error);n.TranspileError=l,function(e){e.Lua53="5.3",e.LuaJIT="JIT"}(s=n.Target||(n.Target={}));var c=function(){function e(e,n,t){this.indent="",this.checker=e,this.options=n,this.genVarCounter=0,this.transpilingSwitch=0,this.namespace=[],this.importCount=0,this.sourceFile=t,this.isModule=o.TSHelper.isFileModule(t),this.sourceFileName=t.fileName}return e.transpileSourceFile=function(n,t,r){var i=new e(t,r,n),s="";r.addHeader&&(s="--~== AeTF : TypeFall ==~--\n\n");var a=s;return r.dontRequireLuaLib||(a+="--@include AeTF/libs/aetf_lib.min.lua\n",a+='require("AeTF/libs/aetf_lib.min.lua")\n'),i.isModule&&(a+="local exports = exports or {}\n"),a+=i.transpileBlock(n),i.isModule&&(a+="return exports\n"),a},e.prototype.pushIndent=function(){this.indent=this.indent+"    "},e.prototype.popIndent=function(){this.indent=this.indent.slice(4)},e.prototype.definitionName=function(e){return this.namespace.concat(e).join(".")},e.prototype.accessPrefix=function(e){return e&&this.isModule?"local ":""},e.prototype.makeExport=function(e,n,t){var r="";return n&&n.modifiers&&a.getCombinedModifierFlags(n)&a.ModifierFlags.Export&&(r=t?this.indent+"exports."+this.definitionName(e)+" = {}\n":this.indent+"exports."+this.definitionName(e)+" = "+e+"\n"),0===this.namespace.length||a.isModuleDeclaration(n)||(r+=t?this.indent+(this.definitionName(e)+" = {}\n"):this.indent+(this.definitionName(e)+" = ")+e+"\n"),r},e.prototype.getImportPath=function(e){return e},e.prototype.transpileBlock=function(e){var n=this,t="";return a.isBlock(e)?e.statements.forEach(function(e){t+=n.transpileNode(e)}):e.forEachChild(function(e){t+=n.transpileNode(e)}),t},e.prototype.transpileNode=function(e,n){if(o.TSHelper.getChildrenOfType(e,function(e){return e.kind===a.SyntaxKind.DeclareKeyword}).length>0)return"";switch(e.kind){case a.SyntaxKind.ImportDeclaration:return this.transpileImport(e);case a.SyntaxKind.ClassDeclaration:return this.transpileClass(e);case a.SyntaxKind.ModuleDeclaration:return this.transpileNamespace(e);case a.SyntaxKind.ModuleBlock:return this.transpileBlock(e);case a.SyntaxKind.EnumDeclaration:return this.transpileEnum(e);case a.SyntaxKind.FunctionDeclaration:return this.transpileFunctionDeclaration(e);case a.SyntaxKind.VariableStatement:return this.indent+this.transpileVariableStatement(e)+"\n";case a.SyntaxKind.ExpressionStatement:return this.indent+this.transpileExpression(o.TSHelper.getChildren(e)[0])+"\n";case a.SyntaxKind.ReturnStatement:return this.indent+this.transpileReturn(e)+"\n";case a.SyntaxKind.IfStatement:return this.transpileIf(e);case a.SyntaxKind.WhileStatement:return this.transpileWhile(e);case a.SyntaxKind.DoStatement:return this.transpileDoStatement(e);case a.SyntaxKind.ForStatement:return this.transpileFor(e);case a.SyntaxKind.ForOfStatement:return this.transpileForOf(e);case a.SyntaxKind.ForInStatement:return this.transpileForIn(e);case a.SyntaxKind.SwitchStatement:return this.transpileSwitch(e);case a.SyntaxKind.BreakStatement:return this.transpileBreak();case a.SyntaxKind.TryStatement:return this.transpileTry(e);case a.SyntaxKind.ThrowStatement:return this.transpileThrow(e);case a.SyntaxKind.ContinueStatement:return this.transpileContinue(e);case a.SyntaxKind.TypeAliasDeclaration:case a.SyntaxKind.InterfaceDeclaration:case a.SyntaxKind.EndOfFileToken:return"";default:return this.indent+this.transpileExpression(e)+"\n"}},e.prototype.transpileContinue=function(e){return"continue\n"},e.prototype.transpileImport=function(e){var n=this.transpileExpression(e.moduleSpecifier).replace(new RegExp('"',"g"),"");if(!e.importClause||!e.importClause.namedBindings)throw new l("Default Imports are not supported, please use named imports instead!",e);var t=e.importClause.namedBindings;if(a.isNamedImports(t)){var r=p.basename(n)+this.importCount,i=this.getImportPath(n)+".lua",s="--@include "+i+"\nlocal "+r+' = require("'+i+'")\n';return this.importCount++,t.elements.forEach(function(e){var n=e.name.escapedText;e.propertyName?s+="local "+n+" = "+r+"."+e.propertyName.escapedText+"\n":s+="local "+n+" = "+r+"."+e.name.escapedText+"\n"}),s}if(a.isNamespaceImport(t)){var o=this.getImportPath(n);return"local "+t.name.escapedText+" = require("+o+")\n"}throw new l("Unsupported import type.",e)},e.prototype.transpileNamespace=function(e){if(o.TSHelper.isPhantom(this.checker.getTypeAtLocation(e),this.checker)&&e.body)return"local "+this.transpileNode(e.body);var n=this.definitionName(e.name.text),t=this.indent+this.accessPrefix(e)+(e.name.text+" = ")+e.name.text+" or {}\n";return this.namespace.length>0&&(t+=this.indent+(n+" = ")+e.name.text+" or {}\n"),t+=this.makeExport(n,e),t+=this.indent+"do\n",this.pushIndent(),this.namespace.push(e.name.text),e.body&&(t+="--[BUG] Namespaces currently pollute global space, fix soon\n"+this.transpileNode(e.body)),this.namespace.pop(),this.popIndent(),t+=this.indent+"end\n"},e.prototype.transpileEnum=function(e){var n=this,t=0,r="",i=this.checker.getTypeAtLocation(e),s=o.TSHelper.isCompileMembersOnlyEnum(i,this.checker);if(!s){var p=e.name.escapedText;r+=this.indent+this.accessPrefix(e)+(p+"={}\n"),r+=this.makeExport(p,e)}return e.members.forEach(function(i){if(i.initializer){if(!a.isNumericLiteral(i.initializer))throw new l("Only numeric initializers allowed for enums.",e);t=parseInt(i.initializer.text)}if(s){var o=n.definitionName(i.name.escapedText);r+=n.indent+(o+"=")+t+"\n"}else{o=n.definitionName(e.name.escapedText+"."+i.name.escapedText);r+=n.indent+(o+"=")+t+"\n"}t++}),r},e.prototype.transpileBreak=function(){return this.transpilingSwitch>0?"":this.indent+"break\n"},e.prototype.transpileIf=function(e){var n=this.transpileExpression(e.expression),t=this.indent+"if "+n+" then\n";return this.pushIndent(),t+=this.transpileStatement(e.thenStatement),this.popIndent(),e.elseStatement&&(t+=this.indent+"else\n",this.pushIndent(),t+=this.transpileStatement(e.elseStatement),this.popIndent()),t+this.indent+"end\n"},e.prototype.transpileWhile=function(e){var n=this.transpileExpression(e.expression),t=this.indent+"while "+n+" do\n";return this.pushIndent(),t+=this.transpileStatement(e.statement),this.popIndent(),t+this.indent+"end\n"},e.prototype.transpileDoStatement=function(e){var n=this.indent+"repeat\n";return this.pushIndent(),n+=this.transpileStatement(e.statement),this.popIndent(),n+=this.indent+"until not "+this.transpileExpression(e.expression,!0)+"\n"},e.prototype.transpileFor=function(e){for(var n="",t=0,r=e.initializer.declarations;t<r.length;t++){var i=r[t];n+=this.indent+this.transpileVariableDeclaration(i)}return n+=this.indent+"while("+this.transpileExpression(e.condition)+") do\n",this.pushIndent(),n+=this.transpileStatement(e.statement),n+=this.indent+this.transpileExpression(e.incrementor)+"\n",this.popIndent(),n+=this.indent+"end\n"},e.prototype.transpileForOf=function(e){var n=e.initializer.declarations[0].name,t=this.transpileExpression(e.expression),r=o.TSHelper.isArrayType(this.checker.getTypeAtLocation(e.expression),this.checker)?"ipairs":"pairs",i=this.indent+"for _, "+n.escapedText+" in "+r+"("+t+") do\n";return this.pushIndent(),i+=this.transpileStatement(e.statement),this.popIndent(),i+this.indent+"end\n"},e.prototype.transpileForIn=function(e){var n=e.initializer.declarations[0].name,t=this.transpileExpression(e.expression);if(o.TSHelper.isArrayType(this.checker.getTypeAtLocation(e.expression),this.checker))throw new l("Iterating over arrays with 'for in' is not allowed.",e);var r=this.indent+"for "+n.escapedText+", _ in pairs("+t+") do\n";return this.pushIndent(),r+=this.transpileStatement(e.statement),this.popIndent(),r+this.indent+"end\n"},e.prototype.transpileStatement=function(e){return a.isBlock(e)?this.transpileBlock(e):this.transpileNode(e)},e.prototype.transpileSwitch=function(e){var n=this,t=this.transpileExpression(e.expression,!0),r=e.caseBlock.clauses,i=this.indent+"-------Switch statement start-------\n",s="____switch"+this.genVarCounter;return this.genVarCounter++,i+=this.indent+"local "+s+" = {}\n",r.forEach(function(e,t){a.isCaseClause(e)&&(i+=n.indent+"-- case:\n",i+=n.indent+(s+"[")+n.transpileExpression(e.expression,!0)+"] = function()\n"),a.isDefaultClause(e)&&(i+=n.indent+"-- default:\n",i+=n.indent+(s+'["____default')+n.genVarCounter+'"] = function()\n'),n.pushIndent(),n.transpilingSwitch++,e.statements.forEach(function(e){i+=n.transpileNode(e)}),n.transpilingSwitch--;var p=t+1;if(p<r.length&&!o.TSHelper.containsStatement(e.statements,a.SyntaxKind.BreakStatement)){for(var l=r[p];p<r.length&&a.isCaseClause(l)&&0===l.statements.length;)l=r[++p];p!==t&&l&&(a.isCaseClause(l)?i+=n.indent+(s+"[")+n.transpileExpression(l.expression,!0)+"]()\n":i+=n.indent+(s+'["____default')+n.genVarCounter+'"]()\n')}else i+=n.indent+"-- break;\n";n.popIndent(),i+=n.indent+"end\n"}),i+=this.indent+"if "+s+"["+t+"] then "+s+"["+t+"]()\n",i+=this.indent+"elseif "+s+'["____default'+this.genVarCounter+'"] then '+s+'["____default'+this.genVarCounter+'"]() end\n',i+=this.indent+"--------Switch statement end--------\n",this.genVarCounter+=r.length,i},e.prototype.transpileTry=function(e){var n="function()\n";this.pushIndent(),n+=this.transpileBlock(e.tryBlock),this.popIndent(),n+="end";var t="function(e)\nend";if(e.catchClause&&e.catchClause.variableDeclaration){var r=e.catchClause.variableDeclaration.name.escapedText;t=this.indent+"function("+r+")\n",this.pushIndent(),t+=this.transpileBlock(e.catchClause.block),this.popIndent(),t+="end"}var i=this.indent+"xpcall("+n+",\n"+t+")\n";return e.finallyBlock&&(i+=this.transpileBlock(e.finallyBlock)),i},e.prototype.transpileThrow=function(e){if(a.isStringLiteral(e.expression))return'error("'+e.expression.text+'")';throw new l("Unsupported throw expression, only string literals are supported",e.expression)},e.prototype.transpileReturn=function(e){var n=this;if(e.expression){var t=o.TSHelper.findFirstNodeAbove(e,a.isFunctionDeclaration);return t&&o.TSHelper.isTupleReturnFunction(this.checker.getTypeAtLocation(t),this.checker)&&a.isArrayLiteralExpression(e.expression)?"return "+e.expression.elements.map(function(e){return n.transpileExpression(e)}).join(","):"return "+this.transpileExpression(e.expression)}return"return"},e.prototype.transpileExpression=function(e,n){switch(e.kind){case a.SyntaxKind.BinaryExpression:return this.transpileBinaryExpression(e,n);case a.SyntaxKind.ConditionalExpression:return this.transpileConditionalExpression(e,n);case a.SyntaxKind.CallExpression:return this.transpileCallExpression(e);case a.SyntaxKind.PropertyAccessExpression:return this.transpilePropertyAccessExpression(e);case a.SyntaxKind.ElementAccessExpression:return this.transpileElementAccessExpression(e);case a.SyntaxKind.Identifier:return e.text;case a.SyntaxKind.StringLiteral:return'"'+e.text+'"';case a.SyntaxKind.TemplateExpression:return this.transpileTemplateExpression(e);case a.SyntaxKind.NumericLiteral:return e.text;case a.SyntaxKind.TrueKeyword:return"true";case a.SyntaxKind.FalseKeyword:return"false";case a.SyntaxKind.NullKeyword:case a.SyntaxKind.UndefinedKeyword:return"nil";case a.SyntaxKind.ThisKeyword:return"self";case a.SyntaxKind.PostfixUnaryExpression:return this.transpilePostfixUnaryExpression(e);case a.SyntaxKind.PrefixUnaryExpression:return this.transpilePrefixUnaryExpression(e);case a.SyntaxKind.ArrayLiteralExpression:return this.transpileArrayLiteral(e);case a.SyntaxKind.ObjectLiteralExpression:return this.transpileObjectLiteral(e);case a.SyntaxKind.DeleteExpression:return this.transpileExpression(e.expression)+"=nil";case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.ArrowFunction:return this.transpileFunctionExpression(e);case a.SyntaxKind.NewExpression:return this.transpileNewExpression(e);case a.SyntaxKind.ComputedPropertyName:return"["+this.transpileExpression(e.expression)+"]";case a.SyntaxKind.ParenthesizedExpression:return"("+this.transpileExpression(e.expression)+")";case a.SyntaxKind.SuperKeyword:return"self.__base";case a.SyntaxKind.TypeAssertionExpression:case a.SyntaxKind.AsExpression:return this.transpileExpression(e.expression);default:throw new l("Unsupported expression kind: "+o.TSHelper.enumName(e.kind,a.SyntaxKind),e)}},e.prototype.transpileBinaryExpression=function(e,n){var t=this.transpileExpression(e.left,!0),r=this.transpileExpression(e.right,!0),i="";if(this.options.luaTarget===s.LuaJIT)switch(e.operatorToken.kind){case a.SyntaxKind.AmpersandToken:i="bit.band("+t+","+r+")";break;case a.SyntaxKind.AmpersandEqualsToken:i=t+"=bit.band("+t+","+r+")";break;case a.SyntaxKind.BarToken:i="bit.bor("+t+","+r+")";break;case a.SyntaxKind.BarEqualsToken:i=t+"=bit.bor("+t+","+r+")";break;case a.SyntaxKind.LessThanLessThanToken:i="bit.lshift("+t+","+r+")";break;case a.SyntaxKind.LessThanLessThanEqualsToken:i=t+"=bit.lshift("+t+","+r+")";break;case a.SyntaxKind.GreaterThanGreaterThanToken:i="bit.arshift("+t+","+r+")";break;case a.SyntaxKind.GreaterThanGreaterThanEqualsToken:i=t+"=bit.arshift("+t+","+r+")";break;case a.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:i="bit.rshift("+t+","+r+")";break;case a.SyntaxKind.GreaterThanGreaterThanGreaterThanEqualsToken:i=t+"=bit.rshift("+t+","+r+")"}else switch(e.operatorToken.kind){case a.SyntaxKind.AmpersandToken:i=t+"&"+r;break;case a.SyntaxKind.AmpersandEqualsToken:i=t+"="+t+"&"+r;break;case a.SyntaxKind.BarToken:i=t+"|"+r;break;case a.SyntaxKind.BarEqualsToken:i=t+"="+t+"|"+r;break;case a.SyntaxKind.LessThanLessThanToken:i=t+"<<"+r;break;case a.SyntaxKind.LessThanLessThanEqualsToken:i=t+"="+t+"<<"+r;break;case a.SyntaxKind.GreaterThanGreaterThanToken:i=t+">>"+r;break;case a.SyntaxKind.GreaterThanGreaterThanEqualsToken:i=t+"="+t+">>"+r;break;case a.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:i=t+">>>"+r;break;case a.SyntaxKind.GreaterThanGreaterThanGreaterThanEqualsToken:i=t+"="+t+">>>"+r}if(""===i)switch(e.operatorToken.kind){case a.SyntaxKind.PlusEqualsToken:i=t+"="+t+"+"+r;break;case a.SyntaxKind.MinusEqualsToken:i=t+"="+t+"-"+r;break;case a.SyntaxKind.AsteriskEqualsToken:i=t+"="+t+"*"+r;break;case a.SyntaxKind.SlashEqualsToken:i=t+"="+t+"/"+r;break;case a.SyntaxKind.AmpersandAmpersandToken:i=t+" and "+r;break;case a.SyntaxKind.BarBarToken:i=t+" or "+r;break;case a.SyntaxKind.PlusToken:var o=this.checker.getTypeAtLocation(e.left),p=this.checker.getTypeAtLocation(e.right);if(o.flags&a.TypeFlags.String||a.isStringLiteral(e.left)||p.flags&a.TypeFlags.String||a.isStringLiteral(e.right))return t+" .. "+r;i=t+"+"+r;break;case a.SyntaxKind.MinusToken:i=t+"-"+r;break;case a.SyntaxKind.AsteriskToken:i=t+"*"+r;break;case a.SyntaxKind.SlashToken:i=t+"/"+r;break;case a.SyntaxKind.PercentToken:i=t+"%"+r;break;case a.SyntaxKind.GreaterThanToken:i=t+">"+r;break;case a.SyntaxKind.GreaterThanEqualsToken:i=t+">="+r;break;case a.SyntaxKind.LessThanToken:i=t+"<"+r;break;case a.SyntaxKind.LessThanEqualsToken:i=t+"<="+r;break;case a.SyntaxKind.EqualsToken:i=t+"="+r;break;case a.SyntaxKind.EqualsEqualsToken:case a.SyntaxKind.EqualsEqualsEqualsToken:i=t+"=="+r;break;case a.SyntaxKind.ExclamationEqualsToken:case a.SyntaxKind.ExclamationEqualsEqualsToken:i=t+"~="+r;break;case a.SyntaxKind.InKeyword:i=r+"["+t+"]~=~=nil";break;default:throw new l("Unsupported binary operator kind: "+a.tokenToString(e.operatorToken.kind),e)}return n?"("+i+")":i},e.prototype.transpileTemplateExpression=function(e){var n=this,t=['"'+e.head.text+'"'];return e.templateSpans.forEach(function(e){var r=n.transpileExpression(e.expression,!0);a.isTemplateTail(e.literal),t.push("tostring("+r+').."'+e.literal.text+'"')}),t.join("..")},e.prototype.transpileConditionalExpression=function(e,n){return"TS_ITE("+this.transpileExpression(e.condition)+",function() return "+this.transpileExpression(e.whenTrue)+" end,function() return "+this.transpileExpression(e.whenFalse)+" end)"},e.prototype.transpilePostfixUnaryExpression=function(e){var n=this.transpileExpression(e.operand,!0);switch(e.operator){case a.SyntaxKind.PlusPlusToken:return n+"="+n+"+1";case a.SyntaxKind.MinusMinusToken:return n+"="+n+"-1";default:throw new l("Unsupported unary postfix: "+o.TSHelper.enumName(e.kind,a.SyntaxKind),e)}},e.prototype.transpilePrefixUnaryExpression=function(e){var n=this.transpileExpression(e.operand,!0);switch(e.operator){case a.SyntaxKind.PlusPlusToken:return n+"="+n+"+1";case a.SyntaxKind.MinusMinusToken:return n+"="+n+"-1";case a.SyntaxKind.ExclamationToken:return"not "+n;case a.SyntaxKind.MinusToken:return"-"+n;default:throw new l("Unsupported unary prefix: "+o.TSHelper.enumName(e.kind,a.SyntaxKind),e)}},e.prototype.transpileNewExpression=function(e){return this.transpileExpression(e.expression)+".new("+this.transpileArguments(e.arguments,a.createTrue())+")"},e.prototype.transpileCallExpression=function(e){var n;if(a.isPropertyAccessExpression(e.expression)){var t=this.checker.getTypeAtLocation(e.expression.expression);if(t.symbol&&"Math"===t.symbol.escapedName)return n=this.transpileArguments(e.arguments),this.transpileMathExpression(e.expression.name)+"("+n+")";if("String"===this.transpileExpression(e.expression.expression))return n=this.transpileArguments(e.arguments),this.transpileStringExpression(e.expression.name)+"("+n+")";switch(t.flags){case a.TypeFlags.String:case a.TypeFlags.StringLiteral:return this.transpileStringCallExpression(e)}return o.TSHelper.isArrayType(t,this.checker)?this.transpileArrayCallExpression(e):t.symbol&&t.symbol.flags&a.SymbolFlags.Namespace?this.transpileExpression(e.expression)+"("+(n=this.transpileArguments(e.arguments))+")":this.transpileExpression(e.expression.expression)+":"+e.expression.name.escapedText+"("+(n=this.transpileArguments(e.arguments))+")"}return e.expression.kind===a.SyntaxKind.SuperKeyword?(this.transpileExpression(e.expression),"self.__base.constructor("+(n=this.transpileArguments(e.arguments,a.createNode(a.SyntaxKind.ThisKeyword)))+")"):this.transpileExpression(e.expression)+"("+(n=this.transpileArguments(e.arguments))+")"},e.prototype.transpileStringCallExpression=function(e){var n=e.expression,t=this.transpileArguments(e.arguments),r=this.transpileExpression(n.expression);switch(n.name.escapedText){case"replace":return"string.gsub("+r+","+t+")";case"indexOf":return 1===e.arguments.length?"(string.find("+r+","+t+",1,true) or 0)-1":"(string.find("+r+","+t+"+1,true) or 0)-1";case"substring":return 1===e.arguments.length?"string.sub("+r+","+t+"+1)":"string.sub("+r+","+this.transpileExpression(e.arguments[0])+"+1,"+this.transpileExpression(e.arguments[1])+")";case"toLowerCase":return"string.lower("+r+")";case"toUpperCase":return"string.upper("+r+")";case"split":return"TS_split("+r+","+t+")";case"charAt":return"string.sub("+r+","+t+"+1,"+t+"+1)";default:throw new l("Unsupported string function: "+n.name.escapedText,e)}},e.prototype.transpileStringExpression=function(e){var n={fromCharCode:"string.char",fromCodePoint:"utf8.char"};if("fromCodePoint"===e.escapedText&&this.options.luaTarget!==s.Lua53)throw new l("Unsupported string property "+e.escapedText+" is only supported for lua 5.3.",e);if(n[e.escapedText])return""+n[e.escapedText];throw new l("Unsupported string property "+e.escapedText+".",e)},e.prototype.transpileArrayCallExpression=function(e){var n=e.expression,t=this.transpileArguments(e.arguments),r=this.transpileExpression(n.expression);switch(n.name.escapedText){case"push":return"TS_push("+r+", "+t+")";case"forEach":return"TS_forEach("+r+", "+t+")";case"indexOf":return"TS_indexOf("+r+", "+t+")";case"map":return"TS_map("+r+", "+t+")";case"filter":return"TS_filter("+r+", "+t+")";case"some":return"TS_some("+r+", "+t+")";case"every":return"TS_every("+r+", "+t+")";case"slice":return"TS_slice("+r+", "+t+")";case"splice":return"TS_splice("+r+", "+t+")";case"join":return 0===e.arguments.length?"table.concat("+r+', ",")':"table.concat("+r+", "+t+")";default:throw new l("Unsupported array function: "+n.name.escapedText,e)}},e.prototype.transpileArguments=function(e,n){var t=this,r=[];return n&&r.push(this.transpileExpression(n)),e.forEach(function(e){r.push(t.transpileExpression(e))}),r.join(",")},e.prototype.transpilePropertyAccessExpression=function(e){var n=e.name.text,t=this.checker.getTypeAtLocation(e.expression);switch(t.flags){case a.TypeFlags.String:case a.TypeFlags.StringLiteral:return this.transpileStringProperty(e);case a.TypeFlags.Object:if(o.TSHelper.isArrayType(t,this.checker))return this.transpileArrayProperty(e)}return o.TSHelper.isCompileMembersOnlyEnum(t,this.checker)?n:a.isIdentifier(e.expression)&&"Math"===e.expression.escapedText?this.transpileMathExpression(e.name):this.transpileExpression(e.expression)+"."+n},e.prototype.transpileMathExpression=function(e){var n={PI:"pi",abs:"abs",acos:"acos",asin:"asin",atan:"atan",ceil:"ceil",cos:"cos",exp:"exp",floor:"floor",log:"log",max:"max",min:"min",pow:"pow",random:"random",round:"round",sin:"sin",sqrt:"sqrt",tan:"tan"};if(n[e.escapedText])return"math."+n[e.escapedText];throw new l("Unsupported math property "+e.escapedText+".",e)},e.prototype.transpileStringProperty=function(e){var n=e.name;switch(n.escapedText){case"length":return"#"+this.transpileExpression(e.expression);default:throw new l("Unsupported string property: "+n.escapedText,e)}},e.prototype.transpileArrayProperty=function(e){var n=e.name;switch(n.escapedText){case"length":return"#"+this.transpileExpression(e.expression);default:throw new l("Unsupported array property: "+n.escapedText,e)}},e.prototype.transpileElementAccessExpression=function(e){var n=this.transpileExpression(e.expression),t=this.transpileExpression(e.argumentExpression),r=this.checker.getTypeAtLocation(e.expression);return o.TSHelper.isArrayType(r,this.checker)||o.TSHelper.isTupleType(r,this.checker)?n+"["+t+"+1]":o.TSHelper.isStringType(r)?"string.sub("+n+","+t+"+1,"+t+"+1)":n+"["+t+"]"},e.prototype.transpileVariableStatement=function(e){var n=this,t="";return e.declarationList.declarations.forEach(function(r){t+=n.transpileVariableDeclaration(r),t+=n.makeExport(r.name.escapedText,e)}),t},e.prototype.transpileVariableDeclaration=function(e){if(a.isIdentifier(e.name)){var n=e.name;if(e.initializer){var t=this.transpileExpression(e.initializer);return"local "+n.escapedText+" = "+t+"\n"}return"local "+n.escapedText+" = nil\n"}if(a.isArrayBindingPattern(e.name)){t=this.transpileExpression(e.initializer);if(e.name.elements.some(function(e){return!a.isBindingElement(e)||void 0!==e.dotDotDotToken}))throw new l("Ellipsis destruction is not allowed.",e);var r=e.name.elements.map(function(e){return e.name.escapedText}).join(",");return a.isCallExpression(e.initializer)&&o.TSHelper.isTupleReturnFunction(this.checker.getTypeAtLocation(e.initializer.expression),this.checker)?"local "+r+"="+t+"\n":"local "+r+"=unpack("+t+")\n"}throw new l("Unsupported variable declaration type "+o.TSHelper.enumName(e.name.kind,a.SyntaxKind),e)},e.prototype.transpileFunctionDeclaration=function(e){for(var n="",t=e.name.escapedText,r=e.parameters,i=e.body,s=[],a="",o=0;o<r.length;o++){var p=r[o],l=p.name.escapedText;p.dotDotDotToken?(a=l,s.push("...")):s.push(l)}return n+=this.indent+this.accessPrefix(e)+"function "+t+"("+s.join(",")+")\n",this.pushIndent(),""!=a&&(n+="\tlocal "+a+" = { ... } -- Pack spread to non-n selector\n"),n+=this.transpileBlock(i),this.popIndent(),n+=this.indent+"end\n",n+=this.makeExport(t,e)},e.prototype.transpileMethodDeclaration=function(e,n){var t="",r=e.name.escapedText,i=e.parameters,s=e.body,a=["self"];i.forEach(function(e){a.push(e.name.escapedText)});var o=e.parameters.filter(function(e){return void 0!==e.initializer});return t+=this.indent+"function "+n+r+"("+a.join(",")+")\n",this.pushIndent(),t+=this.transpileParameterDefaultValues(o),t+=this.transpileBlock(s),this.popIndent(),t+=this.indent+"end\n"},e.prototype.transpileClass=function(e){var n,t=this,r=!1;if(e.heritageClauses&&e.heritageClauses.forEach(function(e){if(e.token===a.SyntaxKind.ExtendsKeyword){var i=t.checker.getTypeAtLocation(e.types[0]);o.TSHelper.isPureAbstractClass(i,t.checker)||(n=e.types[0]),r=o.TSHelper.hasCustomDecorator(i,t.checker,"!NoClassOr")}}),!e.name)throw new l("Unexpected Error: Node has no Name",e);var i=e.name.escapedText,s="",p=o.TSHelper.isExtensionClass(this.checker.getTypeAtLocation(e),this.checker);if(p)s+=this.makeExport(i,e,!0),n&&(i=n.expression.escapedText);else{var c=r?"":i+" or ";if(n){var u=n.expression.escapedText;s+=this.indent+this.accessPrefix(e)+(i+" = ")+c+u+".new()\n",s+=this.makeExport(i,e)}else s+=this.indent+this.accessPrefix(e)+(i+" = ")+c+"{}\n",s+=this.makeExport(i,e);if(s+=this.indent+(i+".__index = ")+i+"\n",n){u=n.expression.escapedText;s+=this.indent+(i+".__base = ")+u+"\n"}s+=this.indent+"function "+i+".new(construct, ...)\n",s+=this.indent+"    local instance = setmetatable({}, "+i+")\n",s+=this.indent+"    if construct and "+i+".constructor then "+i+".constructor(instance, ...) end\n",s+=this.indent+"    return instance\n",s+=this.indent+"end\n"}for(var h=e.members.filter(a.isPropertyDeclaration).filter(function(e){return e.initializer}),d=function(e){return e.modifiers&&e.modifiers.some(function(e){return e.kind===a.SyntaxKind.StaticKeyword})},f=h.filter(d),x=h.filter(function(e){return!d(e)}),m=0,y=f;m<y.length;m++){var T=y[m],S=T.name.escapedText,g=this.transpileExpression(T.initializer);s+=this.indent+(i+".")+S+" = "+g+"\n"}var E=e.members.filter(a.isConstructorDeclaration)[0];return E?s+=this.transpileConstructor(E,i,x):p||(s+=this.transpileConstructor(a.createConstructor([],[],[],a.createBlock([],!0)),i,x)),e.members.filter(a.isMethodDeclaration).forEach(function(e){s+=t.transpileMethodDeclaration(e,i+".")}),s},e.prototype.transpileConstructor=function(e,n,t){var r=[],i=["self"];e.parameters.forEach(function(e){void 0!==e.modifiers&&r.push(e.name.escapedText),i.push(e.name.escapedText)});for(var s=this.indent+"function "+n+".constructor("+i.join(",")+")\n",a=0,o=r;a<o.length;a++){var p=o[a];s+=this.indent+"    self."+p+" = "+p+"\n"}for(var l=0,c=t;l<c.length;l++){var u=(p=c[l]).name.escapedText,h=this.transpileExpression(p.initializer);s+=this.indent+"    self."+u+" = "+h+"\n"}return this.pushIndent(),s+=this.transpileBlock(e.body),this.popIndent(),s+this.indent+"end\n"},e.prototype.transpileArrayLiteral=function(e){var n=this,t=[];return e.elements.forEach(function(e){t.push(n.transpileExpression(e))}),"{"+t.join(",")+"}"},e.prototype.transpileObjectLiteral=function(e){var n=this,t=[];return e.properties.forEach(function(e){var r=o.TSHelper.getChildren(e),i=r[0],s=r[1];if(a.isIdentifier(i))t.push(i.escapedText+"="+n.transpileExpression(s));else if(a.isComputedPropertyName(i)){var p=n.transpileExpression(i);t.push(p+"="+n.transpileExpression(s))}else{p=n.transpileExpression(i);t.push("["+p+"]="+n.transpileExpression(s))}}),"{"+t.join(",")+"}"},e.prototype.transpileFunctionExpression=function(e){var n=[];e.parameters.forEach(function(e){n.push(e.name.escapedText)});var t=e.parameters.filter(function(e){return void 0!==e.initializer});if(a.isBlock(e.body)||t.length>0){var r="function("+n.join(",")+")\n";return this.pushIndent(),r+=this.transpileParameterDefaultValues(t),r+=this.transpileBlock(e.body),this.popIndent(),r+this.indent+"end\n"}return"function("+n.join(",")+") return "+this.transpileExpression(e.body)+" end"},e.prototype.transpileParameterDefaultValues=function(e){var n=this,t="";return e.filter(function(e){return void 0!==e.initializer}).forEach(function(e){var r=e.name.escapedText,i=n.transpileExpression(e.initializer);t+=n.indent+"if "+r+"==nil then "+r+"="+i+" end\n"}),t},e.AvailableLuaTargets=[s.LuaJIT,s.Lua53],e}();n.LuaTranspiler=c},function(e,n){e.exports=require("yargs")},function(e,n){e.exports=require("fs")},function(e,n,t){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])},function(e,n){function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)});n.__esModule=!0;var s=t(5),a=t(1),o=t(0),p=t(4),l=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return i(n,e),n}(Error);n.CLIError=l;var c={};function u(e,n,t){if(n=n||e.raw)for(var r in n)!c[r]||e.options[r]&&!t||(e.options[r]=n[r])}function h(e){if(0!==e.errors.length){var n=[];for(var t in c)if(c[t]){n.push(t);var r=c[t].alias;r&&("string"==typeof r?n.push(r):n.push.apply(n,r))}e.errors.forEach(function(e){var t=!1;if(5023===e.code){for(var r=0,i=n;r<i.length;r++){var s=i[r];-1!==e.messageText.toString().indexOf(s)&&(t=!0)}if(!t)throw new l("error TS"+e.code+": "+e.messageText)}})}}function d(e){if(!e.options.project)throw new l("error no base path provided, could not find config.");var n;if(n=a.isAbsolute(e.options.project)?e.options.project:a.join(process.cwd(),e.options.project),s.statSync(n).isDirectory())n=a.join(n,"tsconfig.json");else if(s.statSync(n).isFile()&&".ts"===a.extname(n))for(var t=a.dirname(n).split(a.sep),r=t.length;r>0;r--){var i=t.slice(0,r).join("/")+a.sep+"tsconfig.json";if(o.sys.fileExists(i)){n=i;break}}e.options.project=n}n.parseCommandLine=function(e){var n=p.usage("Syntax: TypeFall --optionA --optionB --GLOB\n\n").example("Typefall.js dir/subdir/file.ts [...]","Compile specific file(s)").example("Typefall.js -p dir/subdir/tsconfig.json","Compile TypeFall projects").wrap(p.terminalWidth()).options(c).fail(function(e,n){throw new l(e)}).parse(e),t=o.parseCommandLine(e);if(h(t),u(t,n),t.options.project){d(t);var r=t.options.project,i=s.readFileSync(r).toString(),f=o.parseConfigFileTextToJson(r,i);t=o.parseJsonConfigFileContent(f.config,o.sys,a.dirname(r),t.options)}return u(t),h(t),t.options.project&&!t.options.rootDir&&(t.options.rootDir=a.dirname(t.options.project)),t.options.rootDir||(t.options.rootDir=process.cwd()),t.options.outDir||(t.options.outDir=t.options.rootDir),t},n.findConfigFile=d},function(e,n,t){"use strict";n.__esModule=!0;var r=t(1),i=t(0),s=t(6),a=t(3);function o(e,n){var t=i.createProgram(e,n),s=t.getTypeChecker(),o=i.getPreEmitDiagnostics(t).filter(function(e){return 6054!==e.code});o.forEach(function(e){if(e.file){var n=e.file.getLineAndCharacterOfPosition(e.start),t=n.line,r=n.character,s=i.flattenDiagnosticMessageText(e.messageText,"\n");console.log(e.file.fileName+" ("+(t+1)+","+(r+1)+"): "+s)}else console.log(""+i.flattenDiagnosticMessageText(e.messageText,"\n"))}),o.filter(function(e){return e.category===i.DiagnosticCategory.Error}).length>0&&(console.log("Stopping compilation process because of errors."),process.exit(1)),t.getSourceFiles().forEach(function(e){if(!e.isDeclarationFile)try{var t=n.rootDir,o=a.LuaTranspiler.transpileSourceFile(e,s,n),p=e.fileName;if(n.outDir!==n.rootDir){var l=r.resolve(e.fileName).replace(r.resolve(t),"");p=r.join(n.outDir,l)}if(n.outFile)p=r.isAbsolute(n.outFile)?n.outFile:r.resolve(n.outDir,n.outFile);else{var c=r.basename(p,r.extname(p))+".lua";p=r.join(r.dirname(p),c)}i.sys.writeFile(p,o)}catch(n){if(!n.node)throw n;var u=i.getLineAndCharacterOfPosition(e,n.node.pos);console.error("Encountered error parsing file: "+n.message),console.error(e.fileName+" line: "+(1+u.line)+" column: "+u.character+"\n"+n.stack),process.exit(1)}})}function p(e){e=e||process.argv.slice(2);var n=s.parseCommandLine(e);o(n.fileNames,n.options)}n.compile=o,n.execCommandLine=p,p()}]);