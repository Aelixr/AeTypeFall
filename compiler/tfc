!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.w={},n(n.s=7)}([function(e,t){e.exports=require("typescript")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";t.__esModule=!0;var r=n(0),i=function(){function e(){}return e.getChildren=function(e){var t=[];return e.forEachChild(function(e){t.push(e)}),t},e.getChildrenOfType=function(e,t){return this.getChildren(e).filter(t)},e.enumName=function(e,t){for(var n in t)if(t[n]===e)return n;return"unknown"},e.enumNames=function(e,t){var n=[];for(var r in t)0!=(e&t[r])&&e>=t[r]&&n.push(r);return n},e.containsStatement=function(e,t){return e.some(function(e){return e.kind===t})},e.isFileModule=function(e){return!!e&&e.statements.some(function(e){return 0!=(r.getCombinedModifierFlags(e)&r.ModifierFlags.Export)||e.kind===r.SyntaxKind.ExportAssignment||e.kind===r.SyntaxKind.ExportDeclaration})},e.isStringType=function(e){return 0!=(e.flags&r.TypeFlags.String)||0!=(e.flags&r.TypeFlags.StringLike)||0!=(e.flags&r.TypeFlags.StringLiteral)},e.isArrayType=function(e,t){var n=t.typeToTypeNode(e);return n&&n.kind===r.SyntaxKind.ArrayType},e.isTupleType=function(e,t){var n=t.typeToTypeNode(e);return n&&n.kind===r.SyntaxKind.TupleType},e.isCompileMembersOnlyEnum=function(e,t){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Enum)&&void 0!==e.symbol.getDocumentationComment(t)[0]&&this.hasCustomDecorator(e,t,"!CompileMembersOnly")},e.isPureAbstractClass=function(e,t){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Class)&&this.hasCustomDecorator(e,t,"!PureAbstract")},e.isExtensionClass=function(e,t){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Class)&&this.hasCustomDecorator(e,t,"!Extension")},e.isPhantom=function(e,t){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Namespace)&&this.hasCustomDecorator(e,t,"!Phantom")},e.isTupleReturnFunction=function(e,t){return e.symbol&&0!=(e.symbol.flags&r.SymbolFlags.Function)&&this.hasCustomDecorator(e,t,"!TupleReturn")},e.hasCustomDecorator=function(e,t,n){return!!e.symbol&&e.symbol.getDocumentationComment(t).filter(function(e){return"text"===e.kind}).map(function(e){return e.text.trim()}).filter(function(e){return"!"===e[0]}).indexOf(n)>-1},e.findFirstNodeAbove=function(e,t){for(var n=e;n.parent;){if(t(n.parent))return n.parent;n=n.parent}return null},e}();t.TSHelper=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var s,a=n(0),o=n(2),p=n(1),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r.node=n,r}return i(t,e),t}(Error);t.TranspileError=l,function(e){e.Lua53="5.3",e.LuaJIT="JIT"}(s=t.Target||(t.Target={}));var c=function(){function e(e,t,n){this.indent="",this.checker=e,this.options=t,this.genVarCounter=0,this.transpilingSwitch=0,this.namespace=[],this.importCount=0,this.sourceFile=n,this.isModule=o.TSHelper.isFileModule(n),this.sourceFileName=n.fileName}return e.transpileSourceFile=function(t,n,r){var i=new e(n,r,t),s="";r.addHeader&&(s="--~== AeTF : TypeFall ==~--\n\n");var a=s;return r.dontRequireLuaLib||(a+="--@include AeTF/libs/aetf_lib.min.lua\n",a+='require("AeTF/libs/aetf_lib.min.lua")\n'),i.isModule&&(a+="local exports = exports or {}\n"),a+=i.transpileBlock(t),i.isModule&&(a+="return exports\n"),a},e.prototype.pushIndent=function(){this.indent=this.indent+"    "},e.prototype.popIndent=function(){this.indent=this.indent.slice(4)},e.prototype.definitionName=function(e){return this.namespace.concat(e).join(".")},e.prototype.accessPrefix=function(e){return e&&this.isModule?"local ":""},e.prototype.makeExport=function(e,t,n){var r="";return t&&t.modifiers&&a.getCombinedModifierFlags(t)&a.ModifierFlags.Export&&(r=n?this.indent+"exports."+this.definitionName(e)+" = {}\n":this.indent+"exports."+this.definitionName(e)+" = "+e+"\n"),0===this.namespace.length||a.isModuleDeclaration(t)||(r+=n?this.indent+(this.definitionName(e)+" = {}\n"):this.indent+(this.definitionName(e)+" = ")+e+"\n"),r},e.prototype.getImportPath=function(e){return e},e.prototype.transpileBlock=function(e){var t=this,n="";return a.isBlock(e)?e.statements.forEach(function(e){n+=t.transpileNode(e)}):e.forEachChild(function(e){n+=t.transpileNode(e)}),n},e.prototype.transpileNode=function(e,t){if(o.TSHelper.getChildrenOfType(e,function(e){return e.kind===a.SyntaxKind.DeclareKeyword}).length>0)return"";switch(e.kind){case a.SyntaxKind.ImportDeclaration:return this.transpileImport(e);case a.SyntaxKind.ClassDeclaration:return this.transpileClass(e);case a.SyntaxKind.ModuleDeclaration:return this.transpileNamespace(e);case a.SyntaxKind.ModuleBlock:return this.transpileBlock(e);case a.SyntaxKind.EnumDeclaration:return this.transpileEnum(e);case a.SyntaxKind.FunctionDeclaration:return this.transpileFunctionDeclaration(e);case a.SyntaxKind.VariableStatement:return this.indent+this.transpileVariableStatement(e)+"\n";case a.SyntaxKind.ExpressionStatement:return this.indent+this.transpileExpression(o.TSHelper.getChildren(e)[0])+"\n";case a.SyntaxKind.ReturnStatement:return this.indent+this.transpileReturn(e)+"\n";case a.SyntaxKind.IfStatement:return this.transpileIf(e);case a.SyntaxKind.WhileStatement:return this.transpileWhile(e);case a.SyntaxKind.DoStatement:return this.transpileDoStatement(e);case a.SyntaxKind.ForStatement:return this.transpileFor(e);case a.SyntaxKind.ForOfStatement:return this.transpileForOf(e);case a.SyntaxKind.ForInStatement:return this.transpileForIn(e);case a.SyntaxKind.SwitchStatement:return this.transpileSwitch(e);case a.SyntaxKind.BreakStatement:return this.transpileBreak();case a.SyntaxKind.TryStatement:return this.transpileTry(e);case a.SyntaxKind.ThrowStatement:return this.transpileThrow(e);case a.SyntaxKind.ContinueStatement:return this.transpileContinue(e);case a.SyntaxKind.TypeAliasDeclaration:case a.SyntaxKind.InterfaceDeclaration:case a.SyntaxKind.EndOfFileToken:return"";default:return this.indent+this.transpileExpression(e)+"\n"}},e.prototype.transpileContinue=function(e){return"continue\n"},e.prototype.transpileImport=function(e){var t=this.transpileExpression(e.moduleSpecifier).replace(new RegExp('"',"g"),"");if(!e.importClause||!e.importClause.namedBindings)throw new l("Default Imports are not supported, please use named imports instead!",e);var n=e.importClause.namedBindings;if(a.isNamedImports(n)){var r=p.basename(t)+this.importCount,i=this.getImportPath(t)+".lua",s="--@include "+i+"\nlocal "+r+' = require("'+i+'")\n';return this.importCount++,n.elements.forEach(function(e){var t=e.name.escapedText;e.propertyName?s+="local "+t+" = "+r+"."+e.propertyName.escapedText+"\n":s+="local "+t+" = "+r+"."+e.name.escapedText+"\n"}),s}if(a.isNamespaceImport(n)){var o=this.getImportPath(t);return"local "+n.name.escapedText+" = require("+o+")\n"}throw new l("Unsupported import type.",e)},e.prototype.transpileNamespace=function(e){if(o.TSHelper.isPhantom(this.checker.getTypeAtLocation(e),this.checker)&&e.body)return"local "+this.transpileNode(e.body);var t=this.definitionName(e.name.text),n=this.indent+this.accessPrefix(e)+(e.name.text+" = ")+e.name.text+" or {}\n";return this.namespace.length>0&&(n+=this.indent+(t+" = ")+e.name.text+" or {}\n"),n+=this.makeExport(t,e),n+=this.indent+"do\n",this.pushIndent(),this.namespace.push(e.name.text),e.body&&(n+="--[BUG] Namespaces currently pollute global space, fix soon\n"+this.transpileNode(e.body)),this.namespace.pop(),this.popIndent(),n+=this.indent+"end\n"},e.prototype.transpileEnum=function(e){var t=this,n=0,r="",i=this.checker.getTypeAtLocation(e),s=o.TSHelper.isCompileMembersOnlyEnum(i,this.checker);if(!s){var p=e.name.escapedText;r+=this.indent+this.accessPrefix(e)+(p+"={}\n"),r+=this.makeExport(p,e)}return e.members.forEach(function(i){if(i.initializer){if(!a.isNumericLiteral(i.initializer))throw new l("Only numeric initializers allowed for enums.",e);n=parseInt(i.initializer.text)}if(s){var o=t.definitionName(i.name.escapedText);r+=t.indent+(o+"=")+n+"\n"}else{o=t.definitionName(e.name.escapedText+"."+i.name.escapedText);r+=t.indent+(o+"=")+n+"\n"}n++}),r},e.prototype.transpileBreak=function(){return this.transpilingSwitch>0?"":this.indent+"break\n"},e.prototype.transpileIf=function(e){var t=this.transpileExpression(e.expression),n=this.indent+"if "+t+" then\n";return this.pushIndent(),n+=this.transpileStatement(e.thenStatement),this.popIndent(),e.elseStatement&&(n+=this.indent+"else\n",this.pushIndent(),n+=this.transpileStatement(e.elseStatement),this.popIndent()),n+this.indent+"end\n"},e.prototype.transpileWhile=function(e){var t=this.transpileExpression(e.expression),n=this.indent+"while "+t+" do\n";return this.pushIndent(),n+=this.transpileStatement(e.statement),this.popIndent(),n+this.indent+"end\n"},e.prototype.transpileDoStatement=function(e){var t=this.indent+"repeat\n";return this.pushIndent(),t+=this.transpileStatement(e.statement),this.popIndent(),t+=this.indent+"until not "+this.transpileExpression(e.expression,!0)+"\n"},e.prototype.transpileFor=function(e){for(var t="",n=0,r=e.initializer.declarations;n<r.length;n++){var i=r[n];t+=this.indent+this.transpileVariableDeclaration(i)}return t+=this.indent+"while("+this.transpileExpression(e.condition)+") do\n",this.pushIndent(),t+=this.transpileStatement(e.statement),t+=this.indent+this.transpileExpression(e.incrementor)+"\n",this.popIndent(),t+=this.indent+"end\n"},e.prototype.transpileForOf=function(e){var t=e.initializer.declarations[0].name,n=this.transpileExpression(e.expression),r=o.TSHelper.isArrayType(this.checker.getTypeAtLocation(e.expression),this.checker)?"ipairs":"pairs",i=this.indent+"for _, "+t.escapedText+" in "+r+"("+n+") do\n";return this.pushIndent(),i+=this.transpileStatement(e.statement),this.popIndent(),i+this.indent+"end\n"},e.prototype.transpileForIn=function(e){var t=e.initializer.declarations[0].name,n=this.transpileExpression(e.expression);if(o.TSHelper.isArrayType(this.checker.getTypeAtLocation(e.expression),this.checker))throw new l("Iterating over arrays with 'for in' is not allowed.",e);var r=this.indent+"for "+t.escapedText+", _ in pairs("+n+") do\n";return this.pushIndent(),r+=this.transpileStatement(e.statement),this.popIndent(),r+this.indent+"end\n"},e.prototype.transpileStatement=function(e){return a.isBlock(e)?this.transpileBlock(e):this.transpileNode(e)},e.prototype.transpileSwitch=function(e){var t=this,n=this.transpileExpression(e.expression,!0),r=e.caseBlock.clauses,i=this.indent+"-------Switch statement start-------\n",s="____switch"+this.genVarCounter;return this.genVarCounter++,i+=this.indent+"local "+s+" = {}\n",r.forEach(function(e,n){a.isCaseClause(e)&&(i+=t.indent+"-- case:\n",i+=t.indent+(s+"[")+t.transpileExpression(e.expression,!0)+"] = function()\n"),a.isDefaultClause(e)&&(i+=t.indent+"-- default:\n",i+=t.indent+(s+'["____default')+t.genVarCounter+'"] = function()\n'),t.pushIndent(),t.transpilingSwitch++,e.statements.forEach(function(e){i+=t.transpileNode(e)}),t.transpilingSwitch--;var p=n+1;if(p<r.length&&!o.TSHelper.containsStatement(e.statements,a.SyntaxKind.BreakStatement)){for(var l=r[p];p<r.length&&a.isCaseClause(l)&&0===l.statements.length;)l=r[++p];p!==n&&l&&(a.isCaseClause(l)?i+=t.indent+(s+"[")+t.transpileExpression(l.expression,!0)+"]()\n":i+=t.indent+(s+'["____default')+t.genVarCounter+'"]()\n')}else i+=t.indent+"-- break;\n";t.popIndent(),i+=t.indent+"end\n"}),i+=this.indent+"if "+s+"["+n+"] then "+s+"["+n+"]()\n",i+=this.indent+"elseif "+s+'["____default'+this.genVarCounter+'"] then '+s+'["____default'+this.genVarCounter+'"]() end\n',i+=this.indent+"--------Switch statement end--------\n",this.genVarCounter+=r.length,i},e.prototype.transpileTry=function(e){var t="function()\n";this.pushIndent(),t+=this.transpileBlock(e.tryBlock),this.popIndent(),t+="end";var n="function(e)\nend";if(e.catchClause&&e.catchClause.variableDeclaration){var r=e.catchClause.variableDeclaration.name.escapedText;n=this.indent+"function("+r+")\n",this.pushIndent(),n+=this.transpileBlock(e.catchClause.block),this.popIndent(),n+="end"}var i=this.indent+"xpcall("+t+",\n"+n+")\n";return e.finallyBlock&&(i+=this.transpileBlock(e.finallyBlock)),i},e.prototype.transpileThrow=function(e){if(a.isStringLiteral(e.expression))return'error("'+e.expression.text+'")';throw new l("Unsupported throw expression, only string literals are supported",e.expression)},e.prototype.transpileReturn=function(e){var t=this;if(e.expression){var n=o.TSHelper.findFirstNodeAbove(e,a.isFunctionDeclaration);return n&&o.TSHelper.isTupleReturnFunction(this.checker.getTypeAtLocation(n),this.checker)&&a.isArrayLiteralExpression(e.expression)?"return "+e.expression.elements.map(function(e){return t.transpileExpression(e)}).join(","):"return "+this.transpileExpression(e.expression)}return"return"},e.prototype.transpileExpression=function(e,t){switch(e.kind){case a.SyntaxKind.BinaryExpression:return this.transpileBinaryExpression(e,t);case a.SyntaxKind.ConditionalExpression:return this.transpileConditionalExpression(e,t);case a.SyntaxKind.CallExpression:return this.transpileCallExpression(e);case a.SyntaxKind.PropertyAccessExpression:return this.transpilePropertyAccessExpression(e);case a.SyntaxKind.ElementAccessExpression:return this.transpileElementAccessExpression(e);case a.SyntaxKind.Identifier:return e.text;case a.SyntaxKind.StringLiteral:return'"'+e.text+'"';case a.SyntaxKind.TemplateExpression:return this.transpileTemplateExpression(e);case a.SyntaxKind.NumericLiteral:return e.text;case a.SyntaxKind.TrueKeyword:return"true";case a.SyntaxKind.FalseKeyword:return"false";case a.SyntaxKind.NullKeyword:case a.SyntaxKind.UndefinedKeyword:return"nil";case a.SyntaxKind.ThisKeyword:return"self";case a.SyntaxKind.PostfixUnaryExpression:return this.transpilePostfixUnaryExpression(e);case a.SyntaxKind.PrefixUnaryExpression:return this.transpilePrefixUnaryExpression(e);case a.SyntaxKind.ArrayLiteralExpression:return this.transpileArrayLiteral(e);case a.SyntaxKind.ObjectLiteralExpression:return this.transpileObjectLiteral(e);case a.SyntaxKind.DeleteExpression:return this.transpileExpression(e.expression)+"=nil";case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.ArrowFunction:return this.transpileFunctionExpression(e);case a.SyntaxKind.NewExpression:return this.transpileNewExpression(e);case a.SyntaxKind.ComputedPropertyName:return"["+this.transpileExpression(e.expression)+"]";case a.SyntaxKind.ParenthesizedExpression:return"("+this.transpileExpression(e.expression)+")";case a.SyntaxKind.SuperKeyword:return"self.__base";case a.SyntaxKind.TypeAssertionExpression:case a.SyntaxKind.AsExpression:return this.transpileExpression(e.expression);default:throw new l("Unsupported expression kind: "+o.TSHelper.enumName(e.kind,a.SyntaxKind),e)}},e.prototype.transpileBinaryExpression=function(e,t){var n=this.transpileExpression(e.left,!0),r=this.transpileExpression(e.right,!0),i="";switch(e.operatorToken.kind){case a.SyntaxKind.AmpersandToken:i="bit.band("+n+","+r+")";break;case a.SyntaxKind.AmpersandEqualsToken:i=n+"=bit.band("+n+","+r+")";break;case a.SyntaxKind.BarToken:i="bit.bor("+n+","+r+")";break;case a.SyntaxKind.BarEqualsToken:i=n+"=bit.bor("+n+","+r+")";break;case a.SyntaxKind.LessThanLessThanToken:i="bit.lshift("+n+","+r+")";break;case a.SyntaxKind.LessThanLessThanEqualsToken:i=n+"=bit.lshift("+n+","+r+")";break;case a.SyntaxKind.GreaterThanGreaterThanToken:i="bit.arshift("+n+","+r+")";break;case a.SyntaxKind.GreaterThanGreaterThanEqualsToken:i=n+"=bit.arshift("+n+","+r+")";break;case a.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:i="bit.rshift("+n+","+r+")";break;case a.SyntaxKind.GreaterThanGreaterThanGreaterThanEqualsToken:i=n+"=bit.rshift("+n+","+r+")"}if(""===i)switch(e.operatorToken.kind){case a.SyntaxKind.PlusEqualsToken:i=n+"="+n+"+"+r;break;case a.SyntaxKind.MinusEqualsToken:i=n+"="+n+"-"+r;break;case a.SyntaxKind.AsteriskEqualsToken:i=n+"="+n+"*"+r;break;case a.SyntaxKind.SlashEqualsToken:i=n+"="+n+"/"+r;break;case a.SyntaxKind.AmpersandAmpersandToken:i=n+" and "+r;break;case a.SyntaxKind.BarBarToken:i=n+" or "+r;break;case a.SyntaxKind.PlusToken:var s=this.checker.getTypeAtLocation(e.left),o=this.checker.getTypeAtLocation(e.right);if(s.flags&a.TypeFlags.String||a.isStringLiteral(e.left)||o.flags&a.TypeFlags.String||a.isStringLiteral(e.right))return n+" .. "+r;i=n+"+"+r;break;case a.SyntaxKind.MinusToken:i=n+"-"+r;break;case a.SyntaxKind.AsteriskToken:i=n+"*"+r;break;case a.SyntaxKind.SlashToken:i=n+"/"+r;break;case a.SyntaxKind.PercentToken:i=n+"%"+r;break;case a.SyntaxKind.GreaterThanToken:i=n+">"+r;break;case a.SyntaxKind.GreaterThanEqualsToken:i=n+">="+r;break;case a.SyntaxKind.LessThanToken:i=n+"<"+r;break;case a.SyntaxKind.LessThanEqualsToken:i=n+"<="+r;break;case a.SyntaxKind.EqualsToken:i=n+"="+r;break;case a.SyntaxKind.EqualsEqualsToken:case a.SyntaxKind.EqualsEqualsEqualsToken:i=n+"=="+r;break;case a.SyntaxKind.ExclamationEqualsToken:case a.SyntaxKind.ExclamationEqualsEqualsToken:i=n+"~="+r;break;case a.SyntaxKind.InKeyword:i=r+"["+n+"]~=~=nil";break;default:throw new l("Unsupported binary operator kind: "+a.tokenToString(e.operatorToken.kind),e)}return t?"("+i+")":i},e.prototype.transpileTemplateExpression=function(e){var t=this,n=['"'+e.head.text+'"'];return e.templateSpans.forEach(function(e){var r=t.transpileExpression(e.expression,!0);a.isTemplateTail(e.literal),n.push("tostring("+r+').."'+e.literal.text+'"')}),n.join("..")},e.prototype.transpileConditionalExpression=function(e,t){return"TS_ITE("+this.transpileExpression(e.condition)+",function() return "+this.transpileExpression(e.whenTrue)+" end,function() return "+this.transpileExpression(e.whenFalse)+" end)"},e.prototype.transpilePostfixUnaryExpression=function(e){var t=this.transpileExpression(e.operand,!0);switch(e.operator){case a.SyntaxKind.PlusPlusToken:return t+"="+t+"+1";case a.SyntaxKind.MinusMinusToken:return t+"="+t+"-1";default:throw new l("Unsupported unary postfix: "+o.TSHelper.enumName(e.kind,a.SyntaxKind),e)}},e.prototype.transpilePrefixUnaryExpression=function(e){var t=this.transpileExpression(e.operand,!0);switch(e.operator){case a.SyntaxKind.PlusPlusToken:return t+"="+t+"+1";case a.SyntaxKind.MinusMinusToken:return t+"="+t+"-1";case a.SyntaxKind.ExclamationToken:return"not "+t;case a.SyntaxKind.MinusToken:return"-"+t;default:throw new l("Unsupported unary prefix: "+o.TSHelper.enumName(e.kind,a.SyntaxKind),e)}},e.prototype.transpileNewExpression=function(e){return this.transpileExpression(e.expression)+".new("+this.transpileArguments(e.arguments,a.createTrue())+")"},e.prototype.transpileCallExpression=function(e){var t;if(a.isPropertyAccessExpression(e.expression)){var n=this.checker.getTypeAtLocation(e.expression.expression);if(n.symbol&&"Math"===n.symbol.escapedName)return t=this.transpileArguments(e.arguments),this.transpileMathExpression(e.expression.name)+"("+t+")";if("String"===this.transpileExpression(e.expression.expression))return t=this.transpileArguments(e.arguments),this.transpileStringExpression(e.expression.name)+"("+t+")";switch(n.flags){case a.TypeFlags.String:case a.TypeFlags.StringLiteral:return this.transpileStringCallExpression(e)}return o.TSHelper.isArrayType(n,this.checker)?this.transpileArrayCallExpression(e):n.symbol&&n.symbol.flags&a.SymbolFlags.Namespace?this.transpileExpression(e.expression)+"("+(t=this.transpileArguments(e.arguments))+")":this.transpileExpression(e.expression.expression)+":"+e.expression.name.escapedText+"("+(t=this.transpileArguments(e.arguments))+")"}return e.expression.kind===a.SyntaxKind.SuperKeyword?(this.transpileExpression(e.expression),"self.__base.constructor("+(t=this.transpileArguments(e.arguments,a.createNode(a.SyntaxKind.ThisKeyword)))+")"):this.transpileExpression(e.expression)+"("+(t=this.transpileArguments(e.arguments))+")"},e.prototype.transpileStringCallExpression=function(e){var t=e.expression,n=this.transpileArguments(e.arguments),r=this.transpileExpression(t.expression);switch(t.name.escapedText){case"replace":return"string.gsub("+r+","+n+")";case"indexOf":return 1===e.arguments.length?"(string.find("+r+","+n+",1,true) or 0)-1":"(string.find("+r+","+n+"+1,true) or 0)-1";case"substring":return 1===e.arguments.length?"string.sub("+r+","+n+"+1)":"string.sub("+r+","+this.transpileExpression(e.arguments[0])+"+1,"+this.transpileExpression(e.arguments[1])+")";case"toLowerCase":return"string.lower("+r+")";case"toUpperCase":return"string.upper("+r+")";case"split":return"TS_split("+r+","+n+")";case"charAt":return"string.sub("+r+","+n+"+1,"+n+"+1)";default:throw new l("Unsupported string function: "+t.name.escapedText,e)}},e.prototype.transpileStringExpression=function(e){var t={fromCharCode:"string.char",fromCodePoint:"utf8.char"};if("fromCodePoint"===e.escapedText&&this.options.luaTarget!==s.Lua53)throw new l("Unsupported string property "+e.escapedText+" is only supported for lua 5.3.",e);if(t[e.escapedText])return""+t[e.escapedText];throw new l("Unsupported string property "+e.escapedText+".",e)},e.prototype.transpileArrayCallExpression=function(e){var t=e.expression,n=this.transpileArguments(e.arguments),r=this.transpileExpression(t.expression);switch(t.name.escapedText){case"push":return"TS_push("+r+", "+n+")";case"forEach":return"TS_forEach("+r+", "+n+")";case"indexOf":return"TS_indexOf("+r+", "+n+")";case"map":return"TS_map("+r+", "+n+")";case"filter":return"TS_filter("+r+", "+n+")";case"some":return"TS_some("+r+", "+n+")";case"every":return"TS_every("+r+", "+n+")";case"slice":return"TS_slice("+r+", "+n+")";case"splice":return"TS_splice("+r+", "+n+")";case"join":return 0===e.arguments.length?"table.concat("+r+', ",")':"table.concat("+r+", "+n+")";default:throw new l("Unsupported array function: "+t.name.escapedText,e)}},e.prototype.transpileArguments=function(e,t){var n=this,r=[];return t&&r.push(this.transpileExpression(t)),e.forEach(function(e){r.push(n.transpileExpression(e))}),r.join(",")},e.prototype.transpilePropertyAccessExpression=function(e){var t=e.name.text,n=this.checker.getTypeAtLocation(e.expression);switch(n.flags){case a.TypeFlags.String:case a.TypeFlags.StringLiteral:return this.transpileStringProperty(e);case a.TypeFlags.Object:if(o.TSHelper.isArrayType(n,this.checker))return this.transpileArrayProperty(e)}return o.TSHelper.isCompileMembersOnlyEnum(n,this.checker)?t:a.isIdentifier(e.expression)&&"Math"===e.expression.escapedText?this.transpileMathExpression(e.name):this.transpileExpression(e.expression)+"."+t},e.prototype.transpileMathExpression=function(e){var t={PI:"pi",abs:"abs",acos:"acos",asin:"asin",atan:"atan",ceil:"ceil",cos:"cos",exp:"exp",floor:"floor",log:"log",max:"max",min:"min",pow:"pow",random:"random",round:"round",sin:"sin",sqrt:"sqrt",tan:"tan"};if(t[e.escapedText])return"math."+t[e.escapedText];throw new l("Unsupported math property "+e.escapedText+".",e)},e.prototype.transpileStringProperty=function(e){var t=e.name;switch(t.escapedText){case"length":return"#"+this.transpileExpression(e.expression);default:throw new l("Unsupported string property: "+t.escapedText,e)}},e.prototype.transpileArrayProperty=function(e){var t=e.name;switch(t.escapedText){case"length":return"#"+this.transpileExpression(e.expression);default:throw new l("Unsupported array property: "+t.escapedText,e)}},e.prototype.transpileElementAccessExpression=function(e){var t=this.transpileExpression(e.expression),n=this.transpileExpression(e.argumentExpression),r=this.checker.getTypeAtLocation(e.expression);return o.TSHelper.isArrayType(r,this.checker)||o.TSHelper.isTupleType(r,this.checker)?t+"["+n+"+1]":o.TSHelper.isStringType(r)?"string.sub("+t+","+n+"+1,"+n+"+1)":t+"["+n+"]"},e.prototype.transpileVariableStatement=function(e){var t=this,n="";return e.declarationList.declarations.forEach(function(r){n+=t.transpileVariableDeclaration(r),n+=t.makeExport(r.name.escapedText,e)}),n},e.prototype.transpileVariableDeclaration=function(e){if(a.isIdentifier(e.name)){var t=e.name;if(e.initializer){var n=this.transpileExpression(e.initializer);return"local "+t.escapedText+" = "+n+"\n"}return"local "+t.escapedText+" = nil\n"}if(a.isArrayBindingPattern(e.name)){n=this.transpileExpression(e.initializer);if(e.name.elements.some(function(e){return!a.isBindingElement(e)||void 0!==e.dotDotDotToken}))throw new l("Ellipsis destruction is not allowed.",e);var r=e.name.elements.map(function(e){return e.name.escapedText}).join(",");return a.isCallExpression(e.initializer)&&o.TSHelper.isTupleReturnFunction(this.checker.getTypeAtLocation(e.initializer.expression),this.checker)?"local "+r+"="+n+"\n":"local "+r+"=unpack("+n+")\n"}throw new l("Unsupported variable declaration type "+o.TSHelper.enumName(e.name.kind,a.SyntaxKind),e)},e.prototype.transpileFunctionDeclaration=function(e){for(var t="",n=e.name.escapedText,r=e.parameters,i=e.body,s=[],a="",o=0;o<r.length;o++){var p=r[o],l=p.name.escapedText;p.dotDotDotToken?(a=l,s.push("...")):s.push(l)}return t+=this.indent+this.accessPrefix(e)+"function "+n+"("+s.join(",")+")\n",this.pushIndent(),""!=a&&(t+="\tlocal "+a+" = { ... } -- Pack spread to non-n selector\n"),t+=this.transpileBlock(i),this.popIndent(),t+=this.indent+"end\n",t+=this.makeExport(n,e)},e.prototype.transpileMethodDeclaration=function(e,t){var n="",r=e.name.escapedText,i=e.parameters,s=e.body,a=["self"];i.forEach(function(e){a.push(e.name.escapedText)});var o=e.parameters.filter(function(e){return void 0!==e.initializer});return n+=this.indent+"function "+t+r+"("+a.join(",")+")\n",this.pushIndent(),n+=this.transpileParameterDefaultValues(o),n+=this.transpileBlock(s),this.popIndent(),n+=this.indent+"end\n"},e.prototype.transpileClass=function(e){var t,n=this,r=!1;if(e.heritageClauses&&e.heritageClauses.forEach(function(e){if(e.token===a.SyntaxKind.ExtendsKeyword){var i=n.checker.getTypeAtLocation(e.types[0]);o.TSHelper.isPureAbstractClass(i,n.checker)||(t=e.types[0]),r=o.TSHelper.hasCustomDecorator(i,n.checker,"!NoClassOr")}}),!e.name)throw new l("Unexpected Error: Node has no Name",e);var i=e.name.escapedText,s="",p=o.TSHelper.isExtensionClass(this.checker.getTypeAtLocation(e),this.checker);if(p)s+=this.makeExport(i,e,!0),t&&(i=t.expression.escapedText);else{var c=r?"":i+" or ";if(t){var u=t.expression.escapedText;s+=this.indent+this.accessPrefix(e)+(i+" = ")+c+u+".new()\n",s+=this.makeExport(i,e)}else s+=this.indent+this.accessPrefix(e)+(i+" = ")+c+"{}\n",s+=this.makeExport(i,e);if(s+=this.indent+(i+".__index = ")+i+"\n",t){u=t.expression.escapedText;s+=this.indent+(i+".__base = ")+u+"\n"}s+=this.indent+"function "+i+".new(construct, ...)\n",s+=this.indent+"    local instance = setmetatable({}, "+i+")\n",s+=this.indent+"    if construct and "+i+".constructor then "+i+".constructor(instance, ...) end\n",s+=this.indent+"    return instance\n",s+=this.indent+"end\n"}for(var h=e.members.filter(a.isPropertyDeclaration).filter(function(e){return e.initializer}),d=function(e){return e.modifiers&&e.modifiers.some(function(e){return e.kind===a.SyntaxKind.StaticKeyword})},f=h.filter(d),x=h.filter(function(e){return!d(e)}),m=0,y=f;m<y.length;m++){var T=y[m],S=T.name.escapedText,g=this.transpileExpression(T.initializer);s+=this.indent+(i+".")+S+" = "+g+"\n"}var E=e.members.filter(a.isConstructorDeclaration)[0];return E?s+=this.transpileConstructor(E,i,x):p||(s+=this.transpileConstructor(a.createConstructor([],[],[],a.createBlock([],!0)),i,x)),e.members.filter(a.isMethodDeclaration).forEach(function(e){s+=n.transpileMethodDeclaration(e,i+".")}),s},e.prototype.transpileConstructor=function(e,t,n){var r=[],i=["self"];e.parameters.forEach(function(e){void 0!==e.modifiers&&r.push(e.name.escapedText),i.push(e.name.escapedText)});for(var s=this.indent+"function "+t+".constructor("+i.join(",")+")\n",a=0,o=r;a<o.length;a++){var p=o[a];s+=this.indent+"    self."+p+" = "+p+"\n"}for(var l=0,c=n;l<c.length;l++){var u=(p=c[l]).name.escapedText,h=this.transpileExpression(p.initializer);s+=this.indent+"    self."+u+" = "+h+"\n"}return this.pushIndent(),s+=this.transpileBlock(e.body),this.popIndent(),s+this.indent+"end\n"},e.prototype.transpileArrayLiteral=function(e){var t=this,n=[];return e.elements.forEach(function(e){n.push(t.transpileExpression(e))}),"{"+n.join(",")+"}"},e.prototype.transpileObjectLiteral=function(e){var t=this,n=[];return e.properties.forEach(function(e){var r=o.TSHelper.getChildren(e),i=r[0],s=r[1];if(a.isIdentifier(i))n.push(i.escapedText+"="+t.transpileExpression(s));else if(a.isComputedPropertyName(i)){var p=t.transpileExpression(i);n.push(p+"="+t.transpileExpression(s))}else{p=t.transpileExpression(i);n.push("["+p+"]="+t.transpileExpression(s))}}),"{"+n.join(",")+"}"},e.prototype.transpileFunctionExpression=function(e){var t=[];e.parameters.forEach(function(e){t.push(e.name.escapedText)});var n=e.parameters.filter(function(e){return void 0!==e.initializer});if(a.isBlock(e.body)||n.length>0){var r="function("+t.join(",")+")\n";return this.pushIndent(),r+=this.transpileParameterDefaultValues(n),r+=this.transpileBlock(e.body),this.popIndent(),r+this.indent+"end\n"}return"function("+t.join(",")+") return "+this.transpileExpression(e.body)+" end"},e.prototype.transpileParameterDefaultValues=function(e){var t=this,n="";return e.filter(function(e){return void 0!==e.initializer}).forEach(function(e){var r=e.name.escapedText,i=t.transpileExpression(e.initializer);n+=t.indent+"if "+r+"==nil then "+r+"="+i+" end\n"}),n},e.AvailableLuaTargets=[s.LuaJIT,s.Lua53],e}();t.LuaTranspiler=c},function(e,t){e.exports=require("yargs")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var s=n(5),a=n(1),o=n(0),p=n(4),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(Error);t.CLIError=l;var c={};function u(e,t,n){if(t=t||e.raw)for(var r in t)!c[r]||e.options[r]&&!n||(e.options[r]=t[r])}function h(e){if(0!==e.errors.length){var t=[];for(var n in c)if(c[n]){t.push(n);var r=c[n].alias;r&&("string"==typeof r?t.push(r):t.push.apply(t,r))}e.errors.forEach(function(e){var n=!1;if(5023===e.code){for(var r=0,i=t;r<i.length;r++){var s=i[r];-1!==e.messageText.toString().indexOf(s)&&(n=!0)}if(!n)throw new l("error TS"+e.code+": "+e.messageText)}})}}function d(e){if(!e.options.project)throw new l("error no base path provided, could not find config.");var t;if(t=a.isAbsolute(e.options.project)?e.options.project:a.join(process.cwd(),e.options.project),s.statSync(t).isDirectory())t=a.join(t,"tsconfig.json");else if(s.statSync(t).isFile()&&".ts"===a.extname(t))for(var n=a.dirname(t).split(a.sep),r=n.length;r>0;r--){var i=n.slice(0,r).join("/")+a.sep+"tsconfig.json";if(o.sys.fileExists(i)){t=i;break}}e.options.project=t}t.parseCommandLine=function(e){var t=p.usage("Syntax: TypeFall --optionA --optionB --GLOB\n\n").example("Typefall.js dir/subdir/file.ts [...]","Compile specific file(s)").example("Typefall.js -p dir/subdir/tsconfig.json","Compile TypeFall projects").wrap(p.terminalWidth()).options(c).fail(function(e,t){throw new l(e)}).parse(e),n=o.parseCommandLine(e);if(h(n),u(n,t),n.options.project){d(n);var r=n.options.project,i=s.readFileSync(r).toString(),f=o.parseConfigFileTextToJson(r,i);n=o.parseJsonConfigFileContent(f.config,o.sys,a.dirname(r),n.options)}return u(n),h(n),n.options.project&&!n.options.rootDir&&(n.options.rootDir=a.dirname(n.options.project)),n.options.rootDir||(n.options.rootDir=process.cwd()),n.options.outDir||(n.options.outDir=n.options.rootDir),n},t.findConfigFile=d},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),i=n(0),s=n(6),a=n(3);function o(e,t){var n=i.createProgram(e,t),s=n.getTypeChecker(),o=i.getPreEmitDiagnostics(n).filter(function(e){return 6054!==e.code});o.forEach(function(e){if(e.file){var t=e.file.getLineAndCharacterOfPosition(e.start),n=t.line,r=t.character,s=i.flattenDiagnosticMessageText(e.messageText,"\n");console.log(e.file.fileName+" ("+(n+1)+","+(r+1)+"): "+s)}else console.log(""+i.flattenDiagnosticMessageText(e.messageText,"\n"))}),o.filter(function(e){return e.category===i.DiagnosticCategory.Error}).length>0&&(console.log("Stopping compilation process because of errors."),process.exit(1)),n.getSourceFiles().forEach(function(e){if(!e.isDeclarationFile)try{var n=t.rootDir,o=a.LuaTranspiler.transpileSourceFile(e,s,t),p=e.fileName;if(t.outDir!==t.rootDir){var l=r.resolve(e.fileName).replace(r.resolve(n),"");p=r.join(t.outDir,l)}if(t.outFile)p=r.isAbsolute(t.outFile)?t.outFile:r.resolve(t.outDir,t.outFile);else{var c=r.basename(p,r.extname(p))+".lua";p=r.join(r.dirname(p),c)}i.sys.writeFile(p,o)}catch(t){if(!t.node)throw t;var u=i.getLineAndCharacterOfPosition(e,t.node.pos);console.error("Encountered error parsing file: "+t.message),console.error(e.fileName+" line: "+(1+u.line)+" column: "+u.character+"\n"+t.stack),process.exit(1)}})}function p(e){e=e||process.argv.slice(2);var t=s.parseCommandLine(e);o(t.fileNames,t.options)}t.compile=o,t.execCommandLine=p,p()}]);